# GitHub Actions CI ワークフロー設定内容説明

## はじめに

このドキュメントは、Node.js向けのGitHub Actionsワークフローテンプレート（`nodejs-ci.yml`）の設定内容を説明しています。  
このテンプレートをリポジトリに適用することで、簡単に継続的インテグレーション（CI）環境を構築し、テストの実行や結果の確認を自動化できます。

本テンプレートでは、テスト実行に **Jest** というJavaScript/TypeScript用のテストフレームワークを使用しています。  
JestはFacebookが開発したテストツールで、シンプルかつ高速にユニットテストやスナップショットテストを実行できます。  
このワークフローはJestのテストを実行し、テスト結果をJSON形式で出力・解析して、GitHubのUIに見やすく表示するようになっています。

---

## GitHub Actionsとは？

GitHub ActionsはGitHubが提供するCI/CD（継続的インテグレーション／継続的デリバリー）サービスです。  
リポジトリのコード変更をトリガーに、自動でビルドやテスト、デプロイなどの処理を実行し、開発の効率化と品質向上を支援します。

---

このリポジトリで設定されているGitHub Actionsのワークフロー **Node.js CI** は、Node.jsプロジェクトに対して自動でビルドとテストを実行し、テスト結果を分かりやすくまとめてGitHubのUIに表示します。

---

## ファイルの設置場所について

GitHub Actionsのワークフロー設定ファイルは、リポジトリ内の以下のディレクトリに配置します。

```
.github/workflows/
```

例えば、今回のNode.js CI設定は以下のパスに配置します。
```
.github/workflows/nodejs-ci.yml
```
---

### 設定の追加

package.jsonに以下の内容を追加する。

```
  "scripts": {
    "build": "tsc",
    "test": "jest"
  },
  "engines": {
    "node": ">=18"
  },
```


### ファイル名について

ワークフロー設定ファイルの名前は自由に付けられます。  
拡張子は `.yml` または `.yaml` である必要がありますが、ファイル名自体はプロジェクトのルールや用途に応じて分かりやすい名前を付ければ問題ありません。

例えば、

- `nodejs-ci.yml`  
- `test-and-build.yml`  
- `ci.yml`

など、複数のワークフローがある場合は用途ごとに分けて管理することもあります。

---
このファイルがプッシュされると自動的にGitHub Actionsが起動し、指定されたイベント（例えば `main` ブランチへのプッシュやプルリクエスト）でワークフローが実行されます。

---

## 本ワークフロー設定ファイルの主な処理内容

1. 依存関係のインストール  
   package-lock.json に基づき、npmパッケージを厳密にインストールします。

2. ビルドの実行（任意）  
   `npm run build` スクリプトがあれば実行します。無ければスキップされます。

3. Jestテストの実行  
   JestをJSON形式で結果を出力しながら実行します。  
   テストが失敗しても処理は続行されます（`|| true` により強制成功扱い）。

4. テスト失敗の警告  
   失敗したテストの件数が1件以上ある場合、GitHub Actionsログ上に黄色の警告メッセージを出します。

5. テスト結果のサマリー生成  
   JSON結果から失敗したテストの詳細を抽出し、Markdown形式でテスト名や失敗場所（ファイルと行番号）をまとめます。  
   失敗がなければ「All tests passed! 🎉」のメッセージを表示します。

6. テスト結果のアーティファクト保存  
   生成したMarkdownファイルをGitHubのアーティファクトとしてアップロードし、後からダウンロード可能にします。

7. GitHub UIへの表示  
   GitHub ActionsのジョブサマリーとしてMarkdownを表示し、テスト結果を見やすくしています。

---

> **注意：**  
> このワークフローでは、Jestのテストが失敗していてもGitHub Actionsのジョブは「正常終了」として扱われます。  
> これはテスト失敗時に後続の処理（テスト結果の集計やサマリー表示など）を必ず実行するための設計です。  
> テスト失敗をジョブの「失敗」として扱いたい場合は、`Run Jest with JSON output` のステップで `|| true` を外してください。
